DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS meals CASCADE;
DROP TABLE IF EXISTS meal_records CASCADE;

CREATE TABLE IF NOT EXISTS users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name VARCHAR(40) NOT NULL,
    email VARCHAR(255) NOT NULL,
    age BIGINT NOT NULL,
    weight BIGINT NOT NULL,
    height BIGINT NOT NULL,
    gender VARCHAR(20) CHECK (gender IN ('MALE', 'FEMALE')),
    goal VARCHAR(20) CHECK (goal IN ('WEIGHT_LOSS', 'KEEP_WEIGHT', 'GAIN_WEIGHT')),
    CONSTRAINT pk_user PRIMARY KEY (id),
    CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS meals (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name VARCHAR(40) NOT NULL,
    kkal REAL NOT NULL,
    protein REAL NOT NULL,
    fats REAL NOT NULL,
    carb REAL NOT NULL,
    CONSTRAINT pk_meal PRIMARY KEY (id),
    CONSTRAINT UQ_MEAL_NAME UNIQUE (name)
);

CREATE TABLE IF NOT EXISTS meal_records (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id BIGINT NOT NULL,
    eaten_kkal REAL NOT NULL,
    meal_date DATE NOT NULL,
    CONSTRAINT pk_meal_records PRIMARY KEY (id),
    CONSTRAINT fk_meal_records FOREIGN KEY (user_id) REFERENCES users(id)
);
